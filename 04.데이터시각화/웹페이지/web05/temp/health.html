<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>공공의료기관현황</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        th, td {
            text-align: center;
        }
        * {
            font-family: "Jua", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center mb-5">공공의료기관현황</h1>

        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
                <form class="mb-2" name="frm">
                    <div class="input-group">
                        <input name="word" class="form-control" placeholder="검색어">
                        <button class="btn btn-primary">검색</button>
                    </div>
                </form>
                <div id="health"></div>
            </div>
        </div>

        <div class="text-center" id="buttons">
            <button class="btn btn-primary px-5" id="pre">이전</button>
            <span class="px-3" id="page">1/10</span>
            <button class="btn btn-primary px-5" id="next">다음</button>
        </div>

        <div class="my-3">
            <img src="" id="image" style="display:none;" width="100%">
        </div>
    </div>

    <script>
        let page = 1;
        let size = 5;

        $(frm).on("submit", function(e) {
            e.preventDefault();
            page = 1;
            getData();
        });

        $("#next").on("click", function () {
            page++;
            getData();
        });

        $("#pre").on("click", function () {
            if (page > 1) {
                page--;
                getData();
            }
        });

        getData();

        function getData() {
            const word = $(frm.word).val();
            $.ajax({
                type: "get",
                url: "/health/data",
                data: { 'page': page, 'size': size, 'word': word },
                success: function (data) {
                    $("#health").html(data.table);
                    const count = data.count;
                    const total = Math.ceil(count / size);
                    $("#page").html(`${page}/${total}`);

                    $("#next").prop("disabled", page >= total);
                    $("#pre").prop("disabled", page <= 1);

                    if (count == 0) $("#buttons").hide();
                    else $("#buttons").show();

                    if (count > 0) {
                        $("#image").show();
                        $("#image").attr("src", "/health/graph?word=" + word);
                    }
                }
            });
        }
    </script>
</body>
</html>
